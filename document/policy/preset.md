# ğŸ¯ Preset ì •ì±…ì˜ ì—­í•  ì •ì˜

**Preset = â€œì˜ë„ ê¸°ë°˜ ì ê¸ˆ ì •ì±… í…œí”Œë¦¿â€**

- êµì‚¬/ë¶€ëª¨ê°€  
    ğŸ‘‰ _ì•± í•˜ë‚˜í•˜ë‚˜ ì„ íƒí•˜ì§€ ì•Šì•„ë„_  
    ğŸ‘‰ _ìƒí™©ì— ë§ëŠ” ì ê¸ˆ ì •ì±…ì„ ì¦‰ì‹œ ì ìš©_
    
- QR / ì˜ˆì•½ì ê¸ˆ / ì¦‰ì‹œì ê¸ˆ ì „ë¶€ ë™ì¼í•˜ê²Œ ì‚¬ìš©

---

# 1ï¸âƒ£ Preset UX ì„¤ê³„ (êµì‚¬ / ë¶€ëª¨ ê³µí†µ)

## ğŸ”¹ Preset ì„ íƒ ì§„ì…ì 

### êµì‚¬

- ìˆ˜ì—… ìƒì„± ì‹œ
- QR ìƒì„± ì‹œ
- ìˆ˜ì—… ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ

### ë¶€ëª¨

- ìë…€ ì ê¸ˆ ì‹œì‘ ë²„íŠ¼
- ê³ ì •í˜• QR ìƒì„±
- ì‹œê°„í‘œ ê¸°ë°˜ ì˜ˆì•½ ì„¤ì •

---

## ğŸ”¹ Preset ì„ íƒ í™”ë©´ (1ì°¨)

> **â€œì–´ë–¤ ìƒí™©ì¸ê°€ìš”?â€**

### Preset ì¹´ë“œ UI ì˜ˆì‹œ

| ì•„ì´ì½˜      | Preset ì´ë¦„ | ì„¤ëª…           |
| -------- | --------- | ------------ |
| ğŸ“       | ìˆ˜ì—… ì§‘ì¤‘     | í•™ìŠµ ì•±ë§Œ í—ˆìš©     |
| ğŸ“       | ì‹œí—˜ ëª¨ë“œ     | ëª¨ë“  ì•± ì°¨ë‹¨      |
| ğŸ“š       | ììœ¨ í•™ìŠµ     | êµìœ¡ + ë„êµ¬ í—ˆìš©   |
| ğŸ        | ì§‘ì—ì„œ ê³µë¶€    | ê²Œì„/ì†Œì…œ ì°¨ë‹¨     |
| ğŸŒ™       | ì·¨ì¹¨ ì‹œê°„     | í†µì‹  ì•±ë§Œ í—ˆìš©     |
| ğŸ‘¨â€ğŸ‘©â€ğŸ‘§.      | ë¶€ëª¨ ê´€ë¦¬     | ë³´í˜¸ì ì§€ì • ì•±ë§Œ í—ˆìš© |

ğŸ‘‰ **ì„¤ëª… ë¬¸êµ¬ ì¤‘ìš”** (ì‹¬ì‚¬ìš©/ì‹ ë¢°ë„)

---

## ğŸ”¹ Preset ìƒì„¸ ë¯¸ë¦¬ë³´ê¸° (2ì°¨)

Preset ì„ íƒ ì‹œ ë°”ë¡œ ì ìš© âŒ  
ğŸ‘‰ **â€œì´ë ‡ê²Œ ì ê¹ë‹ˆë‹¤â€ ë¯¸ë¦¬ë³´ê¸°**

### ì˜ˆì‹œ

```
í—ˆìš© ì¹´í…Œê³ ë¦¬:
âœ” EDUCATION
âœ” UTILITIES

ì°¨ë‹¨:
âœ– GAMES
âœ– SOCIAL
âœ– ENTERTAINMENT
```

- êµì‚¬/ë¶€ëª¨ëŠ” ì—¬ê¸°ì„œ **ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ ê°€ëŠ¥ (ì„ íƒ)**

---

## ğŸ”¹ ì»¤ìŠ¤í„°ë§ˆì´ì¦ˆ (Optional)

- í—ˆìš© ì¹´í…Œê³ ë¦¬ ì¶”ê°€/ì œê±°
- íŠ¹ì • ì•± ì˜ˆì™¸ í—ˆìš©
- ì ê¸ˆ ì‹œê°„ ìˆ˜ì •
    

ğŸ“Œ **ìˆ˜ì •í•´ë„ Preset ì›ë³¸ì€ ìœ ì§€**  
â†’ â€œë‚´ Presetâ€ìœ¼ë¡œ ì €ì¥ ê°€ëŠ¥

---

# 2ï¸âƒ£ Preset ì •ì±… íƒ€ì… ë¶„ë¥˜

```text
SYSTEM_PRESET   (ë½ëª¨ë¨¼íŠ¸ ì œê³µ, ìˆ˜ì • ë¶ˆê°€)
ORG_PRESET      (ê¸°ê´€ ê³µìš©)
USER_PRESET     (ë¶€ëª¨/êµì‚¬ ê°œì¸)
```



# âœ… Preset ì •ì±… ìµœì¢… ì„¤ê³„ (ì‹ ê·œ ìƒì„± ê¸°ì¤€)

## 0ï¸âƒ£ ì„¤ê³„ ìš”ì•½ (í•µì‹¬ë§Œ)

|êµ¬ë¶„|ë‚´ìš©|
|---|---|
|Preset ëª©ì |ì ê¸ˆ / ì¶œì„ / ì ê¸ˆ+ì¶œì„|
|QR ì‚¬ìš©|ì¶œì„ ì „ìš© QR ê°€ëŠ¥|
|Scope|SYSTEM / ORG / USER|
|ì ê¸ˆ ì •ì±…|ATTENDANCE_ONLY ì—ì„œëŠ” **ì™„ì „ ë¹„í™œì„±**|
|í†µê³„|preset_usage ë¡œ ì¶”ì |

---

# 1ï¸âƒ£ ENUM ì •ì˜ (ë¨¼ì € ì‹¤í–‰)

```sql
-- Preset ì†Œìœ  ë²”ìœ„
CREATE TYPE preset_scope_enum AS ENUM (
  'SYSTEM',  -- ë½ëª¨ë¨¼íŠ¸ ì œê³µ
  'ORG',     -- ê¸°ê´€ ê³µìš©
  'USER'     -- ë¶€ëª¨/êµì‚¬ ê°œì¸
);

-- Preset ëª©ì  (í•µì‹¬)
CREATE TYPE preset_purpose_enum AS ENUM (
  'LOCK_ONLY',
  'ATTENDANCE_ONLY',
  'LOCK_AND_ATTENDANCE'
);

-- ì ê¸ˆ íƒ€ì…
CREATE TYPE lock_type_enum AS ENUM (
  'FULL',      -- ì „ì²´ ì ê¸ˆ
  'APP_ONLY'   -- ì•± ì ê¸ˆ
);

-- Preset ì ìš© ëŒ€ìƒ
CREATE TYPE preset_target_enum AS ENUM (
  'STUDENT',
  'DEVICE',
  'CLASS'
);
```

---

# 2ï¸âƒ£ preset_policies í…Œì´ë¸” (í•µì‹¬ í…Œì´ë¸”)

```sql
CREATE TABLE preset_policies (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- SYSTEM / ORG / USER
  scope preset_scope_enum NOT NULL,

  -- SYSTEM = NULL
  -- ORG    = organization_id
  -- USER   = user_id
  owner_id UUID NULL,

  name VARCHAR(100) NOT NULL,
  description TEXT,

  -- ğŸ”‘ Preset ëª©ì  (ì ê¸ˆ / ì¶œì„ / ë‘˜ë‹¤)
  purpose preset_purpose_enum NOT NULL DEFAULT 'LOCK_AND_ATTENDANCE',

  -- ğŸ” ì ê¸ˆ ê´€ë ¨ (ATTENDANCE_ONLY ì—ì„œëŠ” NULL)
  lock_type lock_type_enum,
  allowed_categories JSONB,
  blocked_categories JSONB,
  allowed_apps JSONB,
  default_duration_minutes INT,

  is_active BOOLEAN DEFAULT TRUE,

  created_at TIMESTAMPTZ DEFAULT now(),
  updated_at TIMESTAMPTZ DEFAULT now(),

  -- ğŸ”’ ì¶œì„ ì „ìš© preset ë¬´ê²°ì„± ë³´ì¥
  CONSTRAINT chk_attendance_only_preset
    CHECK (
      purpose <> 'ATTENDANCE_ONLY'
      OR (
        lock_type IS NULL
        AND allowed_categories IS NULL
        AND blocked_categories IS NULL
        AND allowed_apps IS NULL
        AND default_duration_minutes IS NULL
      )
    )
);
```

---

## ğŸ“Œ ì¸ë±ìŠ¤ (ì‹¤ìš´ì˜ í•„ìˆ˜)

```sql
-- scope + owner ê¸°ì¤€ ì¡°íšŒ (ê¸°ê´€/ìœ ì € preset ëª©ë¡)
CREATE INDEX idx_preset_policies_scope_owner
  ON preset_policies(scope, owner_id);

-- í™œì„± preset ë¹ ë¥¸ ì¡°íšŒ
CREATE INDEX idx_preset_policies_active
  ON preset_policies(is_active);

-- purpose í•„í„° (ì¶œì„ ì „ìš© / ì ê¸ˆ ì „ìš©)
CREATE INDEX idx_preset_policies_purpose
  ON preset_policies(purpose);
```

---

# 3ï¸âƒ£ preset_usage í…Œì´ë¸” (ì‚¬ìš© ì¶”ì  & í†µê³„)

```sql
CREATE TABLE preset_usage (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  preset_id UUID NOT NULL
    REFERENCES preset_policies(id)
    ON DELETE CASCADE,

  used_by UUID NOT NULL
    REFERENCES users(id),

  target_type preset_target_enum NOT NULL,
  target_id UUID NOT NULL,

  purpose preset_purpose_enum NOT NULL,

  -- ì ê¸ˆ presetì¼ ê²½ìš°ë§Œ ì—°ê²°
  applied_policy_id UUID
    REFERENCES lock_policies(id),

  applied_at TIMESTAMPTZ DEFAULT now()
);
```

### ì¸ë±ìŠ¤

```sql
CREATE INDEX idx_preset_usage_preset
  ON preset_usage(preset_id);

CREATE INDEX idx_preset_usage_used_by
  ON preset_usage(used_by);

CREATE INDEX idx_preset_usage_target
  ON preset_usage(target_type, target_id);

CREATE INDEX idx_preset_usage_applied_at
  ON preset_usage(applied_at);
```

---

# 4ï¸âƒ£ lock_policies í…Œì´ë¸” (Preset ì—°ê³„ ì „ì œ)

> ì•„ì§ ìƒì„± ì „ì´ë¼ë©´ **ì²˜ìŒë¶€í„° ì•„ë˜ êµ¬ì¡°ë¡œ ê°€ëŠ” ê±¸ ì¶”ì²œ**

```sql
CREATE TABLE lock_policies (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  preset_id UUID
    REFERENCES preset_policies(id),

  purpose preset_purpose_enum NOT NULL DEFAULT 'LOCK_ONLY',

  lock_type lock_type_enum NOT NULL,
  allowed_categories JSONB,
  blocked_categories JSONB,
  allowed_apps JSONB,

  duration_minutes INT NOT NULL,

  is_customized BOOLEAN DEFAULT FALSE,

  created_by UUID REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT now()
);
```

---

# 5ï¸âƒ£ QR ìƒì„± ì‹œ ë™ì‘ ë§¤í•‘ (ì„œë²„ ë¡œì§ ê¸°ì¤€)

|preset.purpose|lock_policies ìƒì„±|ì¶œì„ ê¸°ë¡|
|---|---|---|
|ATTENDANCE_ONLY|âŒ|âœ…|
|LOCK_ONLY|âœ…|âŒ|
|LOCK_AND_ATTENDANCE|âœ…|âœ…|

---

# 6ï¸âƒ£ ì´ ì„¤ê³„ì˜ ì¥ì 

âœ” **ì¶œì„ ì „ìš© QR ì™„ë²½ ì§€ì›**  
âœ” í•™ì›/í•™êµ ì‹¤ì‚¬ìš© ì‹œë‚˜ë¦¬ì˜¤ 100% ì»¤ë²„  
âœ” Apple / Kakao ì‹¬ì‚¬ ì„¤ëª… ì‰¬ì›€  
âœ” í†µê³„ / ì¶”ì²œ preset / UX ê°œì„ ê¹Œì§€ í™•ì¥ ê°€ëŠ¥  
âœ” ë‚˜ì¤‘ì— â€œì‹œí—˜ëª¨ë“œ / ì„¤ëª…íšŒëª¨ë“œâ€ ê°™ì€ SYSTEM preset ì¶”ê°€ ì‰¬ì›€

---

**ë½ëª¨ë¨¼íŠ¸ Preset ìƒì„±/ì ìš© API ìŠ¤í™ (HTTP v2 ê¸°ì¤€)**ì„  
ğŸ‘‰ **ì‹¤ì œ ì„œë²„Â·ì•± ê°œë°œ ë°”ë¡œ ë“¤ì–´ê°ˆ ìˆ˜ ìˆê²Œ** ì •ë¦¬í•´ì¤„ê²Œ.  
(ë¶€ëª¨/êµì‚¬/ê¸°ê´€/ìš´ì˜ì ê¶Œí•œ + ì¶œì„ ì „ìš©ê¹Œì§€ ë°˜ì˜)

---

# 1ï¸âƒ£ Preset ëª©ë¡ ì¡°íšŒ

## GET /presets

**ì„¤ëª…**

- SYSTEM / ORG / USER preset í†µí•© ì¡°íšŒ
- role ê¸°ë°˜ í•„í„°ë§

### Query Params

|íŒŒë¼ë¯¸í„°|ì„¤ëª…|
|---|---|
|scope|SYSTEM \| ORG \| USER|
|purpose|LOCK_ONLY \| ATTENDANCE_ONLY \| LOCK_AND_ATTENDANCE|
|isActive|true \| false|

### Request

```
GET /v2/presets?scope=ORG&purpose=ATTENDANCE_ONLY
```

### Response

```json
{
  "success": true,
  "data": [
    {
      "id": "uuid",
      "scope": "ORG",
      "name": "ìˆ˜ì—… ì¶œì„ ì „ìš©",
      "purpose": "ATTENDANCE_ONLY",
      "lockType": null,
      "defaultDurationMinutes": null,
      "isActive": true
    }
  ]
}
```

---

# 2ï¸âƒ£ Preset ìƒì„¸ ì¡°íšŒ

## GET /presets/{presetId}

```
GET /v2/presets/uuid
```

```json
{
  "success": true,
  "data": {
    "id": "uuid",
    "scope": "USER",
    "ownerId": "user_uuid",
    "name": "ì§‘ì¤‘ëª¨ë“œ",
    "description": "ìˆ˜ì—…ì‹œê°„ ì§‘ì¤‘",
    "purpose": "LOCK_AND_ATTENDANCE",
    "lockType": "APP_ONLY",
    "allowedCategories": ["EDUCATION"],
    "blockedCategories": ["GAME", "SOCIAL"],
    "allowedApps": [],
    "defaultDurationMinutes": 120
  }
}
```

---

# 3ï¸âƒ£ Preset ìƒì„±

## POST /presets

**ê¶Œí•œ**

- SYSTEM â†’ ìš´ì˜ì
- ORG â†’ ê¸°ê´€ ê´€ë¦¬ì / êµì‚¬
- USER â†’ ë¶€ëª¨ / êµì‚¬

### Request Body

```json
{
  "scope": "USER",
  "name": "ì¶œì„ë§Œ ì²´í¬",
  "description": "ì ê¸ˆ ì—†ì´ ì¶œì„ë§Œ",
  "purpose": "ATTENDANCE_ONLY",

  "lockType": null,
  "allowedCategories": null,
  "blockedCategories": null,
  "allowedApps": null,
  "defaultDurationMinutes": null
}
```

### Response

```json
{
  "success": true,
  "data": {
    "presetId": "uuid"
  }
}
```

---

# 4ï¸âƒ£ Preset ìˆ˜ì •

## PUT /presets/{presetId}

- SYSTEM preset ìˆ˜ì • âŒ
- ORG / USER ë³¸ì¸ ì†Œìœ ë§Œ ê°€ëŠ¥

```json
{
  "name": "ì§‘ì¤‘ ìˆ˜ì—… ëª¨ë“œ",
  "defaultDurationMinutes": 90,
  "isActive": true
}
```

---

# 5ï¸âƒ£ Preset ë¹„í™œì„±í™” (ì‚­ì œ ëŒ€ì²´)

## PATCH /presets/{presetId}/deactivate

```json
{
  "success": true
}
```

---

# 6ï¸âƒ£ Preset ì ìš© (í•µì‹¬ API)

## POST /presets/{presetId}/apply

**Preset â†’ ëŒ€ìƒì— ì ìš© + QR ìƒì„±**

### Request Body

```json
{
  "targetType": "CLASS",
  "targetId": "class_uuid",

  "schedule": {
    "startAt": "2026-02-10T10:00:00+09:00",
    "endAt": "2026-02-10T12:00:00+09:00"
  },

  "qr": {
    "type": "DYNAMIC",
    "oneTime": true
  }
}
```

### Server ì²˜ë¦¬ ë¡œì§

|preset.purpose|ë™ì‘|
|---|---|
|ATTENDANCE_ONLY|QR + attendance ìƒì„±|
|LOCK_ONLY|lock_policies ìƒì„±|
|LOCK_AND_ATTENDANCE|ë‘˜ ë‹¤ ìƒì„±|

### Response

```json
{
  "success": true,
  "data": {
    "qrId": "uuid",
    "qrPayload": "encrypted_payload",
    "lockPolicyId": "uuid_or_null"
  }
}
```

---

# 7ï¸âƒ£ Preset ì‚¬ìš© ì´ë ¥ ì¡°íšŒ

## GET /presets/{presetId}/usage

```json
{
  "success": true,
  "data": [
    {
      "targetType": "CLASS",
      "targetId": "uuid",
      "purpose": "ATTENDANCE_ONLY",
      "appliedAt": "2026-02-09T09:00:00+09:00"
    }
  ]
}
```

---

# 8ï¸âƒ£ ì¶”ì²œ Preset (UXìš©)

## GET /presets/recommended

**ê¸°ì¤€**

- role
    
- ìµœê·¼ ì‚¬ìš©
    
- ê¸°ê´€ ìœ í˜• (í•™êµ/í•™ì›)
    

```json
{
  "success": true,
  "data": [
    {
      "presetId": "uuid",
      "name": "ê¸°ë³¸ ì¶œì„ ì²´í¬",
      "purpose": "ATTENDANCE_ONLY"
    }
  ]
}
```

---

# 9ï¸âƒ£ ê¶Œí•œ ì œì–´ ìš”ì•½

|ì—­í• |SYSTEM|ORG|USER|
|---|---|---|---|
|ìš´ì˜ì|R/W|R|R|
|ê¸°ê´€ê´€ë¦¬ì|R|R/W|R|
|êµì‚¬|R|R/W|R/W|
|ë¶€ëª¨|R|âŒ|R/W|

---

# ğŸ”š ì´ API ì„¤ê³„ì˜ ê°•ì 

âœ” ì¶œì„ ì „ìš© / ì ê¸ˆ ì „ìš© ëª…í™• ë¶„ë¦¬  
âœ” QR â†’ preset â†’ lock/attendance ì¼ê´€ êµ¬ì¡°  
âœ” ëª¨ë°”ì¼/ì›¹/ìš´ì˜ì ê³µìš© API  
âœ” AppleÂ·Kakao ì‹¬ì‚¬ ì„¤ëª… ìš©ì´  
âœ” ë‚˜ì¤‘ì— **ì‹œí—˜ëª¨ë“œ / ì„¤ëª…íšŒ / ììœ¨í•™ìŠµ preset** í™•ì¥ ì‰¬ì›€

---

ë‹¤ìŒìœ¼ë¡œ ì´ì–´ê°€ë©´ ë”± ì¢‹ì€ ê²ƒë“¤ ğŸ‘‡

- **Preset ì ìš© UX í”Œë¡œìš° (êµì‚¬/ë¶€ëª¨/ê¸°ê´€)**
- **QR payload v2 ìµœì¢… ìŠ¤í™**
- **Preset + ìŠ¤ì¼€ì¤„ ìë™ ë°˜ë³µ ì ìš© API**

ì›í•˜ëŠ” ë‹¤ìŒ ë‹¨ê³„ ê³¨ë¼ì¤˜.


ì¢‹ì€ íƒ€ì´ë°ì´ì•¼. ì§€ê¸ˆ ì‹œë‚˜ë¦¬ì˜¤ê°€ **QR = ì •ì±… ì‹¤í–‰ íŠ¸ë¦¬ê±°(ì¶œì„/ì ê¸ˆ/í˜¼í•©)** ë¡œ ëª…í™•í•´ì¡Œê¸° ë•Œë¬¸ì—  
ê¸°ì¡´ `qr_codes`, `qr_device_usage` ëŠ” **êµ¬ì¡°ì ìœ¼ë¡œ ê°ˆì•„ì—ëŠ” ê²Œ ë§ìŒ** ğŸ‘  
ìš”ì²­ëŒ€ë¡œ **DROP â†’ ì‹ ê·œ ìƒì„±**, enum / index ê¹Œì§€ í¬í•¨í•´ì„œ ì •ë¦¬í•´ì¤„ê²Œ.

ì•„ë˜ëŠ” **PostgreSQL ê¸°ì¤€ ìµœì¢…ì•ˆ(v2)** ì´ì•¼.

---

## 0ï¸âƒ£ ì „ì œ: ì‹ ê·œ Enum ì •ì˜

### QR íƒ€ì… / ëª©ì  / ìŠ¤ì¼€ì¤„ / ëŒ€ìƒ

```sql
-- QR ê³ ì •/ë™ì 
CREATE TYPE qr_type_enum AS ENUM (
  'STATIC',     -- ê³ ì •í˜• (ë¶€ëª¨/ì¼ë°˜/ê¸°ê´€ ì¶œì„íŒ)
  'DYNAMIC'     -- 1íšŒì„±/ì„¸ì…˜ìš©
);

-- QR ëª©ì  (Preset purposeì™€ 1:1)
CREATE TYPE qr_purpose_enum AS ENUM (
  'ATTENDANCE_ONLY',
  'LOCK_ONLY',
  'LOCK_AND_ATTENDANCE'
);

-- QR ìŠ¤ì¼€ì¤„ ë°©ì‹
CREATE TYPE qr_schedule_mode_enum AS ENUM (
  'IMMEDIATE',
  'RESERVED'
);

-- QR ì ìš© ëŒ€ìƒ
CREATE TYPE qr_target_type_enum AS ENUM (
  'CLASS',
  'STUDENT',
  'DEVICE',
  'HOME'
);

-- QR ìƒíƒœ
CREATE TYPE qr_status_enum AS ENUM (
  'ACTIVE',
  'EXPIRED',
  'REVOKED'
);
```

---

## 1ï¸âƒ£ ê¸°ì¡´ í…Œì´ë¸” DROP

```sql
DROP TABLE IF EXISTS qr_device_usage CASCADE;
DROP TABLE IF EXISTS qr_codes CASCADE;
```

---

## 2ï¸âƒ£ qr_codes (QR ë©”íƒ€ + ì •ì±… ì¤‘ì‹¬)

> âœ… QR = â€œë¬´ì—‡ì„ ì‹¤í–‰í• ì§€ ì •ì˜í•˜ëŠ” ì—”í‹°í‹°â€

```sql
CREATE TABLE qr_codes (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- QR ê¸°ë³¸ ì„±ê²©
  qr_type qr_type_enum NOT NULL,
  purpose qr_purpose_enum NOT NULL,

  -- Preset / Policy ì—°ê³„
  preset_id UUID NULL REFERENCES preset_policies(id),
  lock_policy_id UUID NULL REFERENCES lock_policies(id),

  -- ëŒ€ìƒ ì •ë³´
  target_type qr_target_type_enum NOT NULL,
  target_id UUID NOT NULL,

  -- ìŠ¤ì¼€ì¤„
  schedule_mode qr_schedule_mode_enum NOT NULL DEFAULT 'IMMEDIATE',
  valid_from TIMESTAMPTZ NULL,
  valid_to TIMESTAMPTZ NULL,

  -- ì‚¬ìš© ì œì–´
  one_time BOOLEAN DEFAULT FALSE,
  max_scan_count INT NULL, -- NULL = ë¬´ì œí•œ

  -- ìƒíƒœ
  status qr_status_enum DEFAULT 'ACTIVE',

  -- ìƒì„±ì
  created_by UUID NOT NULL REFERENCES users(id),
  created_at TIMESTAMPTZ DEFAULT now(),

  -- ë¬´ê²°ì„± ì²´í¬
  CONSTRAINT chk_qr_valid_time
    CHECK (
      valid_from IS NULL
      OR valid_to IS NULL
      OR valid_from < valid_to
    )
);
```

### ğŸ“Œ í•µì‹¬ í¬ì¸íŠ¸

- **ì¶œì„-only QRë„ preset_idë§Œ ìˆìœ¼ë©´ ë™ì‘**
    
- ì ê¸ˆ ì—†ëŠ” QR â†’ `lock_policy_id IS NULL`
    
- ì˜ˆì•½ QR â†’ `valid_from / valid_to` ì‚¬ìš©
    

---

## 3ï¸âƒ£ qr_device_usage (ì‹¤ì œ ìŠ¤ìº” & ì‹¤í–‰ ë¡œê·¸)

> âœ… â€œëˆ„ê°€, ì–´ë–¤ ê¸°ê¸°ë¡œ, ë¬´ì—‡ì´ ì‹¤í–‰ëëŠ”ì§€â€

```sql
CREATE TABLE qr_device_usage (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  qr_id UUID NOT NULL REFERENCES qr_codes(id) ON DELETE CASCADE,

  -- ìŠ¤ìº” ì£¼ì²´
  user_id UUID NOT NULL REFERENCES users(id),
  device_id UUID NOT NULL REFERENCES devices(id),

  -- ì‹¤í–‰ ê²°ê³¼
  attendance_recorded BOOLEAN DEFAULT FALSE,
  lock_applied BOOLEAN DEFAULT FALSE,

  -- ì‹¤íŒ¨/ì˜ˆì™¸ ì¶”ì 
  failure_reason TEXT NULL,

  scanned_at TIMESTAMPTZ DEFAULT now(),

  -- 1íšŒì„± QR ë³´í˜¸
  CONSTRAINT uq_qr_device_once
    UNIQUE (qr_id, device_id)
);
```

---

## 4ï¸âƒ£ ì¸ë±ìŠ¤ ì„¤ê³„ (ì¤‘ìš”)

### qr_codes

```sql
CREATE INDEX idx_qr_codes_status
  ON qr_codes(status);

CREATE INDEX idx_qr_codes_target
  ON qr_codes(target_type, target_id);

CREATE INDEX idx_qr_codes_valid_time
  ON qr_codes(valid_from, valid_to);

CREATE INDEX idx_qr_codes_created_by
  ON qr_codes(created_by);
```

---

### qr_device_usage

```sql
CREATE INDEX idx_qr_usage_qr
  ON qr_device_usage(qr_id);

CREATE INDEX idx_qr_usage_user
  ON qr_device_usage(user_id);

CREATE INDEX idx_qr_usage_device
  ON qr_device_usage(device_id);

CREATE INDEX idx_qr_usage_scanned_at
  ON qr_device_usage(scanned_at);
```

---

## 5ï¸âƒ£ ë³€ê²½ëœ ì‹œë‚˜ë¦¬ì˜¤ì™€ì˜ ë§¤í•‘ ì •ë¦¬

|ì‹œë‚˜ë¦¬ì˜¤|qr_codes ì„¤ì •|
|---|---|
|ì¶œì„ ì „ìš© QR|purpose=ATTENDANCE_ONLY, lock_policy_id=NULL|
|ì ê¸ˆ ì „ìš© QR|purpose=LOCK_ONLY|
|ìˆ˜ì—… QR|target_type=CLASS|
|ë¶€ëª¨ ê³ ì • QR|qr_type=STATIC, one_time=false|
|1íšŒì„± ìˆ˜ì—… QR|qr_type=DYNAMIC, one_time=true|
|ì˜ˆì•½ ì ê¸ˆ|schedule_mode=RESERVED + valid_from|

---

## 6ï¸âƒ£ ì„œë²„ íŠ¸ëœì­ì…˜ ê¸°ì¤€ (ê¶Œì¥)

**/qr/generate**

```
BEGIN
  1. preset ì¡°íšŒ
  2. (í•„ìš”ì‹œ) lock_policy ìƒì„±
  3. qr_codes INSERT
COMMIT
```

**/qr/scan**

```
BEGIN
  1. qr_codes ê²€ì¦ (status, time)
  2. qr_device_usage INSERT
  3. attendance / lock ì‹¤í–‰
  4. one_time â†’ qr_codes.status = EXPIRED
COMMIT
```

---

## ğŸ”š ë‹¤ìŒìœ¼ë¡œ ì´ì–´ì„œ ì¶”ì²œ

1ï¸âƒ£ **attendance í…Œì´ë¸”ê³¼ qr_device_usage ê´€ê³„ ì •ë¦¬**  
2ï¸âƒ£ **ê³ ì •í˜• QR ì¬ì‚¬ìš© ì •ì±… (ë¶€ëª¨/ì¼ë°˜ ì‚¬ìš©ì)**  
3ï¸âƒ£ **QR payload v2 (ì„œëª… + ë§Œë£Œ + purpose í¬í•¨)**  
4ï¸âƒ£ **RLS ì ìš© (êµì‚¬/ë¶€ëª¨/ìš´ì˜ì ê¶Œí•œë³„ QR ì ‘ê·¼)**



ì¢‹ì•„, ì´ì œ **QR â†’ ì‹¤ì œ ì¶œì„ ë°ì´í„° â†’ í†µê³„** íë¦„ì„ ê¹”ë”í•˜ê²Œ ì •ë¦¬í•  ìˆ˜ ìˆëŠ” ë‹¨ê³„ì•¼.  
ì•„ë˜ëŠ” **attendance â†” qr_device_usage ê´€ê³„ ì¬ì„¤ê³„ + attendance í…Œì´ë¸” DROP & ì‹ ê·œ ìƒì„±** ìµœì¢…ì•ˆì´ì•¼.  
(PostgreSQL ê¸°ì¤€, enum / index í¬í•¨)

---

# 1ï¸âƒ£ ì„¤ê³„ ì›ì¹™ (í•µì‹¬ ìš”ì•½)

### ê´€ê³„ ì •ë¦¬ ê²°ë¡ 

- **qr_device_usage = â€œí–‰ìœ„ ë¡œê·¸ (scan & ì‹¤í–‰ ê²°ê³¼)â€**
- **attendance = â€œê³µì‹ ì¶œì„ ê¸°ë¡ (ë¹„ì¦ˆë‹ˆìŠ¤ ê¸°ì¤€ ë°ì´í„°)â€**
- ê´€ê³„ëŠ” **1 : 0..1**
    - ëª¨ë“  QR ìŠ¤ìº”ì´ ì¶œì„ì€ ì•„ë‹˜
    - ì¶œì„ì´ ë°œìƒí•œ ê²½ìš°ë§Œ attendance row ìƒì„±
- **attendanceëŠ” ë°˜ë“œì‹œ qr_device_usageë¥¼ ì°¸ì¡°** (ì¶œì²˜ ëª…í™•í™”)

---

# 2ï¸âƒ£ ì‹ ê·œ Enum ì •ì˜ (ì¶œì„ ìƒíƒœ í™•ì¥ ëŒ€ë¹„)

```sql
CREATE TYPE attendance_status_enum AS ENUM (
  'PRESENT',     -- ì •ìƒ ì¶œì„
  'LATE',        -- ì§€ê°
  'ABSENT',      -- ê²°ì„ (ì˜ˆì•½/ê´€ë¦¬ì ì²˜ë¦¬)
  'EXCUSED'      -- ì‚¬ìœ  ì¸ì •
);
```

> ğŸ’¡ ì§€ê¸ˆì€ PRESENT ìœ„ì£¼ë¡œ ì“°ê³   
> ì´í›„ ì˜ˆì•½ QR, ìˆ˜ë™ ì²˜ë¦¬ ì‹œ í™•ì¥ ê°€ëŠ¥

---

# 3ï¸âƒ£ ê¸°ì¡´ attendance í…Œì´ë¸” DROP

`DROP TABLE IF EXISTS attendance CASCADE;`

---

# 4ï¸âƒ£ attendance í…Œì´ë¸” ì‹ ê·œ ìƒì„± (ì •ê·œí™” ë²„ì „)

```sql
CREATE TABLE attendance (
  id UUID PRIMARY KEY DEFAULT gen_random_uuid(),

  -- ì¶œì„ ì¶œì²˜ (í•µì‹¬)
  qr_usage_id UUID NOT NULL
    REFERENCES qr_device_usage(id) ON DELETE CASCADE,

  -- ì†Œì† ì •ë³´
  organization_id UUID NOT NULL
    REFERENCES organizations(id),

  class_id UUID NULL
    REFERENCES classes(id),

  -- ì¶œì„ ëŒ€ìƒ
  student_id UUID NOT NULL
    REFERENCES users(id),

  device_id UUID NOT NULL
    REFERENCES devices(id),

  -- ì¶œì„ ìƒíƒœ
  status attendance_status_enum NOT NULL DEFAULT 'PRESENT',

  -- ì¶œì„ ì‹œê° (QR scan ì‹œê°ê³¼ ë¶„ë¦¬ ê°€ëŠ¥)
  attended_at TIMESTAMPTZ NOT NULL DEFAULT now(),

  -- ê´€ë¦¬ì ë³´ì •
  marked_by UUID NULL REFERENCES users(id),
  memo TEXT NULL,

  created_at TIMESTAMPTZ DEFAULT now(),

  -- ë™ì¼ QR ì‚¬ìš©ìœ¼ë¡œ ì¤‘ë³µ ì¶œì„ ë°©ì§€
  CONSTRAINT uq_attendance_qr_usage UNIQUE (qr_usage_id)
);
```

---

# 5ï¸âƒ£ í•µì‹¬ ì¸ë±ìŠ¤ ì„¤ê³„ (í†µê³„ & ì¡°íšŒ ìµœì í™”)

```sql
-- í•™ìƒë³„ ì¶œì„ ì´ë ¥
CREATE INDEX idx_attendance_student
  ON attendance(student_id);

-- ìˆ˜ì—…ë³„ ì¶œì„ í†µê³„
CREATE INDEX idx_attendance_class
  ON attendance(class_id);

-- ê¸°ê´€ë³„ ì¶œì„ ì¡°íšŒ
CREATE INDEX idx_attendance_org
  ON attendance(organization_id);

-- ë‚ ì§œ ê¸°ì¤€ ì¡°íšŒ (ì¼/ì›” í†µê³„)
CREATE INDEX idx_attendance_attended_at
  ON attendance(attended_at);

-- QR ê¸°ë°˜ ì—­ì¶”ì 
CREATE INDEX idx_attendance_qr_usage
  ON attendance(qr_usage_id);
```

---

# 6ï¸âƒ£ qr_device_usage â†” attendance ê´€ê³„ ë‹¤ì´ì–´ê·¸ë¨

```scss
qr_codes
   â”‚
   â–¼
qr_device_usage  (scan + ì‹¤í–‰ ë¡œê·¸)
   â”‚   1
   â–¼   0..1
attendance       (ê³µì‹ ì¶œì„ ê¸°ë¡)
```

---

# 7ï¸âƒ£ /qr/scan ì‹œ íŠ¸ëœì­ì…˜ íë¦„ (ì¶œì„ í¬í•¨ QR)

```bash
BEGIN

1. qr_codes ìœ íš¨ì„± ê²€ì‚¬
2. qr_device_usage INSERT
3. if purpose IN ('ATTENDANCE_ONLY','LOCK_AND_ATTENDANCE'):
     â†’ attendance INSERT
4. if lock í¬í•¨:
     â†’ lock_history INSERT
5. one_time QR:
     â†’ qr_codes.status = EXPIRED

COMMIT
```

---

# 8ï¸âƒ£ ê¸°ì¡´ êµ¬ì¡° ëŒ€ë¹„ ê°œì„  í¬ì¸íŠ¸

|í•­ëª©|ê¸°ì¡´|ê°œì„ |
|---|---|---|
|ì¶œì„ ê¸°ì¤€|class + student|**QR scan ê¸°ì¤€**|
|ì¤‘ë³µ ë°©ì§€|ì• ë§¤|**qr_usage_id UNIQUE**|
|ë¡œê·¸/í†µê³„|í˜¼ì¬|**ë¡œê·¸ vs ê³µì‹ ë°ì´í„° ë¶„ë¦¬**|
|ê°ì‚¬ ì¶”ì |ì–´ë ¤ì›€|**QR â†’ Device â†’ User ì—­ì¶”ì  ê°€ëŠ¥**|

---


# í”Œë«í¼ë³„ ì ê¸ˆ ë™ì‘ ì—°ê²°

## Android

### FULL

- Device Owner / Accessibility ê¸°ë°˜
- í™ˆ, ìµœê·¼ì•± ì°¨ë‹¨
- ê¸´ê¸‰ì „í™”ë§Œ í—ˆìš©

### APP

- QR payloadì˜ `app_policy_id`
- ì„œë²„ì— ë§¤í•‘ëœ **Universal App ID ë¦¬ìŠ¤íŠ¸**
- ì•± ì‹¤í–‰ ì‹œ ì°¨ë‹¨

---

## iOS (Family Controls)

### FULL ëŒ€ì‘ ì „ëµ (Androidì™€ ê°œë… ì¼ì¹˜)

|Android|iOS ëŒ€ì‘|
|---|---|
|ì „ì²´ ì ê¸ˆ|**ëª¨ë“  ì•± + ì¹´í…Œê³ ë¦¬ ì°¨ë‹¨**|
|í™ˆ ì ‘ê·¼ ë¶ˆê°€|í™ˆ ì•± ì œì™¸ ì „ë¶€ Shield|
|í•´ì œ ì‹œê°„|Screen Time ìŠ¤ì¼€ì¤„|

â†’ UX ìƒ **â€œì „ì²´ ì ê¸ˆâ€**ìœ¼ë¡œ í†µì¼ í‘œê¸°

---

### iOS APP ì ê¸ˆ

- `FamilyActivitySelection`
- ì•±/ì¹´í…Œê³ ë¦¬ Shield
- QR â†’ ì„œë²„ â†’ DeviceActivity ìŠ¤ì¼€ì¤„ ë“±ë¡



### âœ… iOSì—ì„œ **ì¹´í…Œê³ ë¦¬ ë‹¨ìœ„ í—ˆìš© ê°€ëŠ¥**

- **Family Controls / Screen Time API**ì—ì„œ
    - ì•± ë‹¨ìœ„ (bundleId)
    - **ì•± ì¹´í…Œê³ ë¦¬ ë‹¨ìœ„**  
        ë‘˜ ë‹¤ ì§€ì›í•¨
        

ì¦‰ ì„œë²„ì—ì„œ  
ğŸ‘‰ **â€œí—ˆìš© ì•± ëª©ë¡ + í—ˆìš© ì¹´í…Œê³ ë¦¬ ëª©ë¡â€** ì„ ë‚´ë ¤ì¤„ ìˆ˜ ìˆìŒ

---

## 2ï¸âƒ£ iOS Family Controlsì˜ ê¸°ë³¸ ê°œë… êµ¬ì¡°

iOSëŠ” **â€œì°¨ë‹¨í•  ê²ƒâ€ì´ ì•„ë‹ˆë¼ â€œí—ˆìš©í•  ê²ƒâ€ì„ ì„ íƒ**í•˜ëŠ” êµ¬ì¡°ì•¼.

### í•µì‹¬ íƒ€ì…

```swift
FamilyActivitySelection
```

ì´ ì•ˆì— ë‘ ê°€ì§€ê°€ ë“¤ì–´ê°

```swift
var applicationTokens: Set<ApplicationToken>
var categoryTokens: Set<ActivityCategoryToken>
```

---

## 3ï¸âƒ£ ì¹´í…Œê³ ë¦¬ ë‹¨ìœ„ í—ˆìš© êµ¬ì¡° (ì¤‘ìš”)

### iOSì—ì„œ ì œê³µí•˜ëŠ” ì£¼ìš” ì¹´í…Œê³ ë¦¬ ì˜ˆì‹œ

|ì¹´í…Œê³ ë¦¬|ì„¤ëª…|
|---|---|
|`.education`|êµìœ¡|
|`.productivity`|ìƒì‚°ì„±|
|`.utilities`|ìœ í‹¸ë¦¬í‹°|
|`.reference`|ì°¸ê³ |
|`.books`|ë„ì„œ|
|`.finance`|ê¸ˆìœµ|
|`.healthAndFitness`|ê±´ê°•|
|`.creativity`|í¬ë¦¬ì—ì´í‹°ë¸Œ|
|`.entertainment`|ì—”í„°í…Œì¸ë¨¼íŠ¸|
|`.games`|ê²Œì„|
|`.socialNetworking`|SNS|

ğŸ‘‰ **ì¹´í…Œê³ ë¦¬ëŠ” Appleì´ ë¶„ë¥˜í•œ App Store ê¸°ì¤€**

---

### ì˜ˆ: â€œêµìœ¡ ì•± + ê³„ì‚°ê¸°ë§Œ í—ˆìš©â€

```swift
var selection = FamilyActivitySelection()

selection.categoryTokens = [
    .education,
    .utilities
]
```

â†’ êµìœ¡ ì•± ì „ì²´ + ê³„ì‚°ê¸°/ì‹œê³„ ê°™ì€ ê¸°ë³¸ ìœ í‹¸ í—ˆìš©  
â†’ ë‚˜ë¨¸ì§€ëŠ” ì „ë¶€ Shield (ì ê¸ˆ)

---

## 4ï¸âƒ£ ì•± ë‹¨ìœ„ + ì¹´í…Œê³ ë¦¬ ë‹¨ìœ„ í˜¼í•© í—ˆìš© (ê¶Œì¥ ì„¤ê³„)

### iOSëŠ” **ë™ì‹œì— ì‚¬ìš© ê°€ëŠ¥**í•¨

```swift
selection.applicationTokens = [
    ApplicationToken(bundleIdentifier: "com.apple.calculator")
]

selection.categoryTokens = [
    .education
]
```

### ì˜ë¯¸

- êµìœ¡ ì¹´í…Œê³ ë¦¬ ì „ì²´ í—ˆìš©
- ê·¸ ì™¸ ì•± ì¤‘ ê³„ì‚°ê¸°ë§Œ ì¶”ê°€ í—ˆìš©
- ë‚˜ë¨¸ì§€ ì „ë¶€ ì ê¸ˆ

ğŸ‘‰ **ë½ëª¨ë¨¼íŠ¸ì— ì•„ì£¼ ì˜ ë§ëŠ” êµ¬ì¡°**

---

## 5ï¸âƒ£ ì„œë²„ ê¸°ì¤€ ì„¤ê³„ (í”Œë«í¼ ê³µí†µí™”)

### ì„œë²„ ì •ì±… ëª¨ë¸ ì˜ˆì‹œ

```json
{
  "allow_policy": {
    "apps": [
      "com.apple.calculator",
      "com.apple.notes"
    ],
    "categories": [
      "EDUCATION",
      "PRODUCTIVITY"
    ]
  }
}
```

### ì„œë²„ â†’ í”Œë«í¼ë³„ ë³€í™˜

|ì„œë²„|Android|iOS|
|---|---|---|
|allow.apps|íŒ¨í‚¤ì§€ëª… í—ˆìš©|bundleId â†’ ApplicationToken|
|allow.categories|âŒ (ì§ì ‘ êµ¬í˜„)|ActivityCategoryToken|

---

## 6ï¸âƒ£ Androidì™€ ê°œë… ì •ë ¬ ë°©ë²• (ì¤‘ìš”)

### AndroidëŠ” â€œí—ˆìš©â€ì´ ì•„ë‹ˆë¼ â€œì°¨ë‹¨â€ ê¸°ë°˜ì´ë¯€ë¡œ ì´ë ‡ê²Œ ë§ì¶˜ë‹¤

### ì„œë²„ëŠ” í•­ìƒ **í—ˆìš© ê¸°ì¤€**ìœ¼ë¡œ ê´€ë¦¬

```
í—ˆìš© ì•± / í—ˆìš© ì¹´í…Œê³ ë¦¬
```

### Android ë³€í™˜ ë¡œì§

1. ì „ì²´ ì•± ëª©ë¡ ì¡°íšŒ
2. í—ˆìš© ì•± + í—ˆìš© ì¹´í…Œê³ ë¦¬ì— ì†í•œ ì•± ì œì™¸
3. ë‚˜ë¨¸ì§€ ì•± â†’ ì ê¸ˆ ëŒ€ìƒ
    

ğŸ“Œ ì¦‰,

> **ì„œë²„ ê°œë…ì€ iOS ê¸°ì¤€ìœ¼ë¡œ í†µì¼**  
> Androidê°€ ê·¸ê±¸ ê³„ì‚°í•´ì„œ ì°¨ë‹¨

ì´ê²Œ ìœ ì§€ë³´ìˆ˜ ì œì¼ ì‰¬ì›€.

---

## 7ï¸âƒ£ UX ì„¤ê³„ íŒ (í˜„ì‹¤ì ìœ¼ë¡œ ì¤‘ìš”)

### ë¶€ëª¨/êµì‚¬ìš© ê¶Œì¥ Preset

|ëª¨ë“œ|í—ˆìš© ì¹´í…Œê³ ë¦¬|
|---|---|
|ìˆ˜ì—… ì§‘ì¤‘|EDUCATION, UTILITIES|
|ìˆ™ì œ ëª¨ë“œ|EDUCATION, REFERENCE|
|ììœ  ì‹œê°„|ENTERTAINMENT, GAMES|
|ì™„ì „ ì§‘ì¤‘|(ë¹„ì›Œë‘  â†’ ì „ë¶€ ì°¨ë‹¨)|

ğŸ‘‰ QR ìƒì„± ì‹œ Preset ì„ íƒë§Œ í•˜ê²Œ í•˜ë©´ UX ë¯¸ì¹œ ë“¯ì´ ì¢‹ì•„ì§

---

## 8ï¸âƒ£ ì œí•œì‚¬í•­ & ì£¼ì˜ì  (ê¼­ ì•Œì•„ì•¼ í•¨)

### âš ï¸ iOS í•œê³„

1. **ì‹œìŠ¤í…œ ì•± ì¼ë¶€ëŠ” ì™„ì „ ì°¨ë‹¨ ë¶ˆê°€**
    - ì „í™”, ì„¤ì • ì¼ë¶€
        
2. **ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜ëŠ” Apple ê¸°ì¤€**
    - ì•± ê°œë°œìê°€ ì˜ëª» ë¶„ë¥˜í•œ ê²½ìš° ìˆìŒ
        
3. **Family Controls ìŠ¹ì¸ í•„ìˆ˜**
    - TestFlightë„ ê¶Œí•œ ìŠ¹ì¸ ì „ì—ëŠ” ì‹¤ì œ Shield ì•ˆ ê±¸ë¦¼
        



# 1ï¸âƒ£ iOS vs Android ì¹´í…Œê³ ë¦¬ ì§€ì› ì°¨ì´ (ì •ë¦¬)

|êµ¬ë¶„|iOS (Family Controls)|Android|
|---|---|---|
|OS ì°¨ì› ì¹´í…Œê³ ë¦¬|âœ… ìˆìŒ|âŒ ì—†ìŒ|
|ì¹´í…Œê³ ë¦¬ ê¸°ì¤€ í—ˆìš©|âœ… native|âŒ ì§ì ‘ ë¶ˆê°€|
|ì•± ë‹¨ìœ„ ì œì–´|âœ…|âœ…|
|ì„œë²„ ì •ì±… ì¼ê´€ì„±|ë§¤ìš° ì¢‹ìŒ|ì„œë²„ ê³„ì‚° í•„ìš”|

ğŸ‘‰ **AndroidëŠ” â€œì¹´í…Œê³ ë¦¬ ê°œë…ì€ ì•± ë ˆë²¨ì—ì„œ êµ¬í˜„â€í•´ì•¼ í•¨**

---

# 2ï¸âƒ£ Androidì—ì„œ ì¹´í…Œê³ ë¦¬ í—ˆìš©ì´ â€œì§ì ‘ ë¶ˆê°€ëŠ¥â€í•œ ì´ìœ 

AndroidëŠ”

- Screen Time / Family Controls ê°™ì€ **ì¤‘ì•™ í†µì œ APIê°€ ì—†ìŒ**
- `UsageStats`, `AccessibilityService`, `Device Owner`ëŠ”
    - **ì•± ë‹¨ìœ„**ë¡œë§Œ ì œì–´ ê°€ëŠ¥
    - â€œì´ ì•±ì€ êµìœ¡ ì¹´í…Œê³ ë¦¬ë‹ˆê¹Œ í—ˆìš©â€ ê°™ì€ ê¸°ëŠ¥ âŒ

ì¦‰,

> **ì¹´í…Œê³ ë¦¬ = ìš°ë¦¬ê°€ ì •ì˜í•´ì•¼ í•˜ëŠ” ë…¼ë¦¬ì  ê·¸ë£¹**

---

# 3ï¸âƒ£ Androidì—ì„œ ê°€ëŠ¥í•œ í˜„ì‹¤ì ì¸ ë°©ë²• (í•µì‹¬)

## âœ… ì „ëµ: â€œì„œë²„ ì •ì˜ ì¹´í…Œê³ ë¦¬ â†’ ì•± ëª©ë¡ ë³€í™˜ â†’ ì ê¸ˆ ì ìš©â€

### ì „ì²´ êµ¬ì¡°

```
[ì„œë²„]
í—ˆìš© ì¹´í…Œê³ ë¦¬ (EDUCATION, UTILITIES)
        â†“
[Android]
ì¹´í…Œê³ ë¦¬ì— ì†í•œ ì•± íŒ¨í‚¤ì§€ ëª©ë¡ ì¡°íšŒ
        â†“
í—ˆìš© ì•± Set ìƒì„±
        â†“
ê·¸ ì™¸ ì•± ì „ë¶€ ì ê¸ˆ
```

---

# 4ï¸âƒ£ Android ì¹´í…Œê³ ë¦¬ ë¶„ë¥˜ ë°©ë²• (3ê°€ì§€)

## â‘  Google Play Store ì¹´í…Œê³ ë¦¬ (ê°€ì¥ ì¶”ì²œ)

### ì•± ì¹´í…Œê³ ë¦¬ ì¡°íšŒ ë°©ë²•

- Google Play Developer API
- ë˜ëŠ” ìì²´ ìˆ˜ì§‘í•œ Play Store ë©”íƒ€ë°ì´í„°

ì˜ˆ:

```
com.google.android.youtube â†’ ENTERTAINMENT
com.google.android.classroom â†’ EDUCATION
```

### ì¥ì 

- iOS ì¹´í…Œê³ ë¦¬ì™€ ê°€ì¥ ìœ ì‚¬
- ê´€ë¦¬ ì¼ê´€ì„± ë†’ìŒ

### ë‹¨ì 

- ì‹ ê·œ ì•± ëŒ€ì‘ì„ ìœ„í•œ ì£¼ê¸°ì  ë™ê¸°í™” í•„ìš”

---

## â‘¡ ë‚´ë¶€ ê³ ì • ë§¤í•‘ í…Œì´ë¸” (ìš´ì˜ ì•ˆì •ì„± â†‘)

### ì„œë²„ í…Œì´ë¸” ì˜ˆì‹œ

```sql
app_category_map
- platform (ANDROID)
- package_name
- category
- updated_at
```

### ìš´ì˜ ë°©ì‹

- ì´ˆê¸°ì— ì£¼ìš” ì•± 90% ì»¤ë²„
- ë¯¸ë¶„ë¥˜ ì•±ì€ ê¸°ë³¸ ì°¨ë‹¨

ğŸ“Œ **êµìœ¡/í•™ì› ì„œë¹„ìŠ¤ì— ë§¤ìš° ì í•©**

---

## â‘¢ ì‚¬ìš©ì ì„ íƒ ê¸°ë°˜ ë³´ì • (ë³´ì¡° ìˆ˜ë‹¨)

- ë¶€ëª¨/êµì‚¬ê°€ â€œì´ ì•±ì€ êµìœ¡ìš©â€ ì²´í¬
- ì„œë²„ì— override ì €ì¥
    

```json
{
  "package": "com.some.app",
  "override_category": "EDUCATION"
}
```

---

# 5ï¸âƒ£ iOS â†’ Android ì¹´í…Œê³ ë¦¬ ë§¤í•‘ ì „ëµ (ì‹¤ì „ìš©)

## ğŸ”‘ ê¸°ì¤€: **ì„œë²„ ì¹´í…Œê³ ë¦¬ë¥¼ Canonical ë¡œ ë‘”ë‹¤**

### ì„œë²„ ê³µí†µ ì¹´í…Œê³ ë¦¬ ì •ì˜

```text
EDUCATION
PRODUCTIVITY
UTILITIES
REFERENCE
ENTERTAINMENT
GAMES
SOCIAL
```

---

### iOS ë§¤í•‘

|ì„œë²„|iOS ActivityCategory|
|---|---|
|EDUCATION|.education|
|PRODUCTIVITY|.productivity|
|UTILITIES|.utilities|
|REFERENCE|.reference|
|ENTERTAINMENT|.entertainment|
|GAMES|.games|
|SOCIAL|.socialNetworking|

---

### Android ë§¤í•‘ (ë…¼ë¦¬ì )

|ì„œë²„|Android ê¸°ì¤€|
|---|---|
|EDUCATION|Play Store: Education|
|PRODUCTIVITY|Productivity|
|UTILITIES|Tools / Utilities|
|REFERENCE|Books / Reference|
|ENTERTAINMENT|Entertainment|
|GAMES|Games|
|SOCIAL|Social|

ğŸ“Œ **AndroidëŠ” â€œì¹´í…Œê³ ë¦¬ â†’ ì•± ë¦¬ìŠ¤íŠ¸â€ë¡œ ë³€í™˜í•˜ëŠ” ë‹¨ê³„ê°€ ì¶”ê°€ë¨**

---

# 6ï¸âƒ£ Android ì ê¸ˆ ì—”ì§„ ê´€ì ì—ì„œì˜ ì²˜ë¦¬ íë¦„

```kotlin
allowedCategories = ["EDUCATION", "UTILITIES"]
allowedApps = getAppsByCategories(allowedCategories)
explicitAllowedApps = policy.allowedApps

finalAllowedApps = allowedApps + explicitAllowedApps

for app in installedApps:
    if app.package !in finalAllowedApps:
        lock(app)
```

âœ” Android ì „ì²´ ì ê¸ˆ  
âœ” Android ì•± ì ê¸ˆ  
âœ” iOS ì¹´í…Œê³ ë¦¬ í—ˆìš©ê³¼ UX ë™ì¼

---

# 7ï¸âƒ£ QR / ì •ì±… ì‹œìŠ¤í…œê³¼ì˜ ê²°í•© (ë½ëª¨ë¨¼íŠ¸ì— ë”± ë§ìŒ)

### QR Payload ì˜ˆì‹œ

```json
{
  "policy_type": "APP_LOCK",
  "allow_categories": ["EDUCATION"],
  "allow_apps": ["com.apple.calculator"],
  "duration": 50
}
```

- iOS â†’ categoryTokens + applicationTokens
    
- Android â†’ category â†’ ì•± ëª©ë¡ â†’ ì°¨ë‹¨ ê³„ì‚°
    

---

# 8ï¸âƒ£ ìš´ì˜ìƒ ë² ìŠ¤íŠ¸ í”„ë™í‹°ìŠ¤ (ê²½í—˜ ê¸°ë°˜)

âœ” **ì„œë²„ ì •ì±…ì€ í•­ìƒ â€œí—ˆìš© ê¸°ì¤€â€**  
âœ” AndroidëŠ” ê³„ì‚° ë‹´ë‹¹  
âœ” ë¯¸ë¶„ë¥˜ ì•±ì€ ê¸°ë³¸ ì°¨ë‹¨  
âœ” êµì‚¬/ë¶€ëª¨ override í—ˆìš©  
âœ” Preset ì¤‘ì‹¬ UX ìœ ì§€


â€œí•œ ë²ˆ ë§Œë“¤ì–´ë‘ë©´ ìš´ì˜ì´ í¸í•´ì§€ëŠ” êµ¬ì¡°â€ ê¸°ì¤€ìœ¼ë¡œ **ì‹¤ì „í˜• ìë™ ë¶„ë¥˜ íŒŒì´í”„ë¼ì¸**ì„ ì •ë¦¬í• ê²Œ.

---

# ğŸ¯ ëª©í‘œ ìš”ì•½

- **iOS FamilyControls ì¹´í…Œê³ ë¦¬ì™€ ì˜ë¯¸ì ìœ¼ë¡œ ì¼ì¹˜**
- **ì‹ ê·œ ì•± ì„¤ì¹˜ ì‹œ ìë™ ë°˜ì˜**
- **ìš´ì˜ì ìˆ˜ë™ ê°œì… ìµœì†Œí™”**
- **ë¯¸ë¶„ë¥˜ ì•±ì€ ê¸°ë³¸ ì°¨ë‹¨**
- **êµì‚¬/ë¶€ëª¨ override ê°€ëŠ¥**

---

# 1ï¸âƒ£ ì „ì²´ ì•„í‚¤í…ì²˜ (í° ê·¸ë¦¼)

```
[Android Device]
  â””â”€ ì„¤ì¹˜ ì•± ëª©ë¡ (package, version)
        â†“
[Client]
  â””â”€ íŒ¨í‚¤ì§€ ë¦¬ìŠ¤íŠ¸ ì „ì†¡
        â†“
[Server]
  â”œâ”€ 1ì°¨: ë‚´ë¶€ ë§¤í•‘ DB ì¡°íšŒ
  â”œâ”€ 2ì°¨: Play Store ì¹´í…Œê³ ë¦¬ ì¡°íšŒ
  â”œâ”€ 3ì°¨: íœ´ë¦¬ìŠ¤í‹±/AI ë³´ì •
  â”œâ”€ 4ì°¨: ìš´ì˜ì/ë¶€ëª¨ override
        â†“
[Canonical Category]
        â†“
[Allowed App Set ê³„ì‚°]
        â†“
[Android Lock Engine]
```

---

# 2ï¸âƒ£ Canonical ì¹´í…Œê³ ë¦¬ (ì„œë²„ ê¸°ì¤€)

**ì ˆëŒ€ Android / iOS ê¸°ì¤€ìœ¼ë¡œ ë¶„ê¸°í•˜ì§€ ë§ ê²ƒ**

```text
EDUCATION
PRODUCTIVITY
UTILITIES
REFERENCE
COMMUNICATION
ENTERTAINMENT
GAMES
SOCIAL
UNKNOWN
```

ğŸ‘‰ iOS / AndroidëŠ” **ì¶œë ¥ ì–´ëŒ‘í„°** ì—­í• ë§Œ í•¨

---

# 3ï¸âƒ£ ë‹¨ê³„ë³„ ìë™ ë¶„ë¥˜ ë¡œì§ (í•µì‹¬)

## ğŸ”¹ STEP 1. ë‚´ë¶€ ê³ ì • ë§¤í•‘ (Fast Path)

### í…Œì´ë¸”

```sql
android_app_category_map
- package_name (PK)
- canonical_category
- source ENUM('MANUAL','PLAYSTORE','AI')
- confidence INT
- updated_at
```

### íŠ¹ì§•

- ìì£¼ ì“°ëŠ” ì•±ì€ **100% ì»¤ë²„**
- ì„±ëŠ¥ ë¹ ë¦„
- ì•ˆì •ì„± ìµœê³ 

âœ” ì „ì²´ ì•±ì˜ 70~80%ëŠ” ì—¬ê¸°ì„œ í•´ê²°

---

## ğŸ”¹ STEP 2. Play Store ì¹´í…Œê³ ë¦¬ ë§¤í•‘

### ë°ì´í„° ì†ŒìŠ¤

- Google Play Store metadata
- ìì²´ í¬ë¡¤ë§ or ìˆ˜ì§‘ DB

### ë³€í™˜ ê·œì¹™ ì˜ˆì‹œ

|Play Store|Canonical|
|---|---|
|Education|EDUCATION|
|Tools|UTILITIES|
|Productivity|PRODUCTIVITY|
|Books & Reference|REFERENCE|
|Entertainment|ENTERTAINMENT|
|Social|SOCIAL|
|Communication|COMMUNICATION|
|Games|GAMES|

ğŸ“Œ **Play Store = ì°¸ê³ ìš©, ì ˆëŒ€ ë‹¨ë… ê¸°ì¤€ X**

---

## ğŸ”¹ STEP 3. íœ´ë¦¬ìŠ¤í‹± ê·œì¹™ (ì¤‘ìš”)

Play Store ë¶„ë¥˜ê°€ ì• ë§¤í•  ë•Œ ë³´ì •

### ì˜ˆì‹œ ê·œì¹™

```text
- íŒ¨í‚¤ì§€ëª…ì— classroom, edu, school í¬í•¨ â†’ EDUCATION
- ì•± ê¶Œí•œì— CALL_LOG + SMS â†’ COMMUNICATION
- Accessibility + Overlay â†’ TOOLS or DEVICE
- ê²Œì„ ì—”ì§„ signature â†’ GAMES
```

### ì ìš© ë°©ì‹

- confidence ì ìˆ˜ ê°€ì‚°
- ê¸°ì¤€ ì´ìƒì´ë©´ ìë™ í™•ì •

---

## ğŸ”¹ STEP 4. AI ë³´ì¡° ë¶„ë¥˜ (ì˜µì…˜, í›„ìˆœìœ„)

> â— ì‹¤ì‹œê°„ í˜¸ì¶œ âŒ  
> âœ” batch / ì‹ ê·œ ì•± ì „ìš©

### ì…ë ¥

```json
{
  "app_name": "Kahoot!",
  "description": "...",
  "permissions": [...],
  "developer": "Kahoot ASA"
}
```

### ì¶œë ¥

```json
{
  "category": "EDUCATION",
  "confidence": 92
}
```

- OpenAI / Vertex AI ê°€ëŠ¥
- ìš´ì˜ì ìŠ¹ì¸ í›„ DB ë°˜ì˜

---

## ğŸ”¹ STEP 5. ë¶€ëª¨/êµì‚¬ Override (ìµœì¢… ìš°ì„ ìˆœìœ„)

```sql
app_category_override
- subject_type (STUDENT | DEVICE)
- subject_id
- package_name
- override_category
- created_by
```

ğŸ“Œ **Override > AI > PlayStore > Manual**

---

# 4ï¸âƒ£ ì‹ ê·œ ì•± ì„¤ì¹˜ ì‹œ ì‹¤ì‹œê°„ ì²˜ë¦¬ íë¦„

```
[ì•± ì„¤ì¹˜ ì´ë²¤íŠ¸]
   â†“
Client â†’ package_name ì „ì†¡
   â†“
Server:
   - DB ì¡°íšŒ
   - ì—†ìœ¼ë©´ Play Store lookup
   - ê²°ê³¼ UNKNOWN â†’ ê¸°ë³¸ ì°¨ë‹¨
   â†“
Android Lock Engine ì¦‰ì‹œ ë°˜ì˜
```

âš ï¸ ì ˆëŒ€ â€œë¶„ë¥˜ë  ë•Œê¹Œì§€ í—ˆìš©â€í•˜ì§€ ë§ ê²ƒ

---

# 5ï¸âƒ£ Android Lock Engine ì—°ê³„ êµ¬ì¡°

### ì •ì±… ê³„ì‚°

```json
{
  "allowed_categories": ["EDUCATION"],
  "allowed_apps": ["com.android.calculator"]
}
```

### ì„œë²„ ê³„ì‚° ê²°ê³¼

```json
{
  "final_allowed_packages": [
    "com.google.android.classroom",
    "com.kahoot.app",
    "com.android.calculator"
  ]
}
```

AndroidëŠ” **ê²°ê³¼ë§Œ ì‹ ë¢°**

---

# 6ï¸âƒ£ ìš´ì˜ì ë„êµ¬ (ì‹¤ë¬´ì—ì„œ ì¤‘ìš”)

## ğŸ“Š ë¯¸ë¶„ë¥˜ ì•± ëŒ€ì‹œë³´ë“œ

- UNKNOWN ì•± ëª©ë¡
- ì„¤ì¹˜ ìˆ˜ ê¸°ì¤€ ì •ë ¬
- ì›í´ë¦­ ì¹´í…Œê³ ë¦¬ ì§€ì •

## ğŸ“¥ CSV ì—…ë¡œë“œ

- í•™ì›ë³„ êµìœ¡ ì•± ì¼ê´„ ë“±ë¡

---

# 7ï¸âƒ£ ë³´ì•ˆ & ì•ˆì •ì„± í¬ì¸íŠ¸

âœ” íŒ¨í‚¤ì§€ëª… ê¸°ì¤€ (appId X)  
âœ” version ë¬´ê´€  
âœ” ì•± ì´ë¦„ ë³€ê²½ì—ë„ ì•ˆì „  
âœ” ë£¨íŒ… ì—¬ë¶€ì™€ ë¬´ê´€

---

# 8ï¸âƒ£ ì„±ëŠ¥ ì „ëµ

- Client â†’ package hash only ì „ì†¡ ê°€ëŠ¥
- ì„œë²„ ê²°ê³¼ ìºì‹œ
- ì •ì±… ë³€ê²½ ì‹œ delta push

---

# 9ï¸âƒ£ ìµœì¢… ì¶”ì²œ êµ¬ì¡° (ë½ëª¨ë¨¼íŠ¸ìš©)

> **Canonical Category ì¤‘ì‹¬ + ì„œë²„ ê³„ì‚° + AndroidëŠ” ì‹¤í–‰ ì „ë‹´**

ì´ êµ¬ì¡°ë©´:

- iOS / Android ì •ì±… 100% í†µí•©
- í•™ì›/í•™êµ/ê°€ì • ê³µí†µ ì‚¬ìš© ê°€ëŠ¥
- QR / ì˜ˆì•½ ì ê¸ˆ / ì‹¤ì‹œê°„ ì ê¸ˆ ì „ë¶€ ì—°ë™ ê°€ëŠ¥